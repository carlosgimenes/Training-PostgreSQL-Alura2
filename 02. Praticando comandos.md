# Alura - PostgreSQL: Views, Sub-Consultas e Fun√ß√µes

## Neste Cap√≠tulo

- [Arquivos para continua√ß√£o do curso](#arquivos-para-continua√ß√£o-do-curso)
- [Preparando Dados](#preparando-dados)
  - [Inserindo Dados em Outras Tabelas](#inserindo-dados-em-outras-tabelas)
  - [Sintaxe Alternativa: Inser√ß√£o Direta sem Declara√ß√£o de Campos](#sintaxe-alternativa-inser√ß√£o-direta-sem-declara√ß√£o-de-campos)
  - [Atualizando Dados com `UPDATE`](#atualizando-dados-com-update)
  - [Impacto do `UPDATE` em Relacionamentos](#impacto-do-update-em-relacionamentos)
  - [Removendo Dados com `DELETE`](#removendo-dados-com-delete)
  - [Testando conhecimento adquirido - Sintaxes diferentes](#testando-conhecimento-adquirido---sintaxes-diferentes)
- [Alunos em mais cursos](#alunos-em-mais-cursos)

---

## **Arquivos para continua√ß√£o do curso**

Aqui s√£o fornecidos os arquivos para continuidade do treinamento.

- [dados-aula-2.sql](./src/dados-aula-2.sql)
- [relatorios-aula-2.sql](./src/relatorios-aula-2.sql)

---

## **Preparando Dados**  

J√° temos nosso banco de dados do PostgreSQL pronto para revisar as diferentes sintaxes de **INSERT**. Ap√≥s essa recapitula√ß√£o, come√ßaremos os exerc√≠cios na pr√≥xima aula.  

A estrutura b√°sica para realizar uma inser√ß√£o de dados √©:  

```sql
INSERT INTO nome_da_tabela (campo1, campo2, campo3) VALUES ('valor1', 'valor2', 'valor3');
```  

Por√©m, existe uma sintaxe alternativa que permite inserir **m√∫ltiplas linhas com uma √∫nica instru√ß√£o**, sem a necessidade de repetir `INSERT INTO` para cada linha.  

Nesse caso, adicionamos os **VALUES** de cada registro dentro de par√™nteses, e **separamos as entradas com v√≠rgulas**, como no exemplo abaixo:  

```sql
INSERT INTO aluno (primeiro_nome, ultimo_nome, data_nascimento) VALUES 
    ('Vinicius', 'Dias', '1997-10-15'),
    ('Patr√≠cia', 'Freitas', '1996-10-25'),
    ('Diogo', 'Oliveira', '1994-08-27'),
    ('Maria', 'Rosa', '1985-01-01');
```  

Essa abordagem **torna o processo mais eficiente**, especialmente ao inserir grandes volumes de dados.  

---

### **Inserindo Dados em Outras Tabelas**  

Podemos utilizar a mesma t√©cnica para preencher a tabela `"categoria"`:  

```sql
INSERT INTO categoria (nome) VALUES 
    ('Front-End'), 
    ('Programa√ß√£o'), 
    ('Banco de Dados'), 
    ('Data Science');
```  

J√° na tabela `"curso"`, al√©m de inserir os nomes dos cursos, precisamos adicionar **a chave estrangeira categoria_id**, garantindo a rela√ß√£o entre as tabelas. Isso significa que, **se tentarmos inserir uma categoria que n√£o existe, o INSERT falhar√°**.  

```sql
INSERT INTO curso (nome, categoria_id) VALUES
    ('HTML', 1),
    ('CSS', 1),
    ('JS', 1),
    ('PHP', 2),
    ('Java', 2),
    ('C++', 2),
    ('PostgreSQL', 3),
    ('MySQL', 3),
    ('Oracle', 3),
    ('SQL Server', 3),
    ('SQLite', 3),
    ('Pandas', 4),
    ('Machine Learning', 4),
    ('Power BI', 4);
```  

---

### **Sintaxe Alternativa: Inser√ß√£o Direta sem Declara√ß√£o de Campos**  

Na tabela `"aluno_curso"`, podemos usar uma **varia√ß√£o** do comando `INSERT`, na qual **omitimos os nomes dos campos**, pois estamos fornecendo valores para **todos os campos existentes na tabela**:  

```sql
INSERT INTO aluno_curso VALUES 
    (1,4), 
    (1,11), 
    (2,1), 
    (2,2), 
    (3,4), 
    (3,3), 
    (4,4), 
    (4,6), 
    (4,5);
```  

Se os valores **n√£o corresponderem √† ordem dos campos na tabela**, o banco de dados retornar√° um erro. Portanto, **a ordem dos valores deve seguir exatamente a estrutura da tabela**.  

Se f√¥ssemos preencher tamb√©m o **campo id** na tabela `"curso"`, poder√≠amos omitir a declara√ß√£o dos campos, pois estar√≠amos atribuindo valores para todos eles. Como o `"id"` √© gerado automaticamente pelo PostgreSQL, **precisamos declar√°-los explicitamente antes de atribuir valores**.

---

### **Atualizando Dados com `UPDATE`**  

Agora, vamos revisar casos nos quais **alteramos um registro que n√£o est√° relacionado a uma chave estrangeira**.  

Por exemplo, imagine que **n√£o temos certeza** se "Data Science" est√° escrito corretamente na tabela `"categoria"`. Podemos realizar uma busca antes de alterar o valor:  

```sql
SELECT * FROM categoria WHERE id = 4;
```  

Ap√≥s confirmar que o dado precisa ser atualizado, utilizamos `UPDATE` para corrigir a informa√ß√£o:  

```sql
UPDATE categoria SET nome = 'Ci√™ncia de Dados' WHERE id = 4;
```  

üö® **IMPORTANTE:** Sempre inclua `WHERE` ao realizar um `UPDATE`. Caso contr√°rio, **todos os registros** da tabela ser√£o alterados!  

Por exemplo, a seguinte instru√ß√£o **incorretamente altera todas as categorias**:  

```sql
UPDATE categoria SET nome = 'Ci√™ncia de Dados';
```  

---

### **Impacto do `UPDATE` em Relacionamentos**  

No curso anterior, aprendemos sobre **ON UPDATE CASCADE**, que define como o banco de dados deve lidar com **altera√ß√µes em registros relacionados**.  

Entretanto, **se atualizarmos um campo que n√£o √© uma chave estrangeira, n√£o precisamos nos preocupar com isso**.  

Por exemplo, ao atualizar `"id = 4"` para `"Ci√™ncia de Dados"` na tabela `"categoria"`, **todos os cursos que pertenciam a essa categoria continuam associados ao mesmo ID**‚Äîe a mudan√ßa √© refletida automaticamente na tabela `"curso"`!  

Isso demonstra como **o uso correto de chaves estrangeiras melhora a consist√™ncia dos dados**, sem a necessidade de altera√ß√µes adicionais.  

---

### **Removendo Dados com `DELETE`**  

Se quisermos excluir uma categoria, devemos **primeiro remover todos os cursos relacionados a ela**.  

Caso contr√°rio, ao executar:  

```sql
DELETE FROM categoria WHERE id = 1;
```  

O banco de dados retornar√° um **erro**, pois existem cursos vinculados a essa categoria.  

---

Essa foi uma **revis√£o r√°pida das diferentes sintaxes do INSERT e UPDATE**, refor√ßando a import√¢ncia de **manter a integridade dos relacionamentos**.  

Na pr√≥xima aula, aplicaremos tudo o que aprendemos para **criar relat√≥rios no PostgreSQL**! üöÄ  

---

### **Testando conhecimento adquirido - Sintaxes diferentes**

Neste v√≠deo n√≥s vimos as diferentes formas de realizar um INSERT no banco de dados.

Levando em considera√ß√£o uma tabela chamada pessoa com os campos id, nome e nascimento, qual das sintaxes a seguir est√° INCORRETA?

![Formas de realizar um INSERT](./images/RevisaoConceitos-FormasRevisarInsert.png)

---

## **Alunos em mais cursos**

Coming soon
